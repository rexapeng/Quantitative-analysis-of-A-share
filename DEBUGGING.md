# 项目调试指南

本指南介绍如何使用项目的调试功能来排查和解决问题。

## 调试模式配置

在 `config.py` 文件中，可以通过以下配置项启用或禁用调试模式：

```python
# 调试模式配置
DEBUG_MODE = True          # 设置为 True 启用调试模式
DEBUG_VERBOSE = True       # 设置为 True 启用详细调试信息
```

- `DEBUG_MODE`: 控制是否启用调试模式
- `DEBUG_VERBOSE`: 控制调试信息的详细程度

## 日志系统

项目使用了完整的日志系统，日志保存在 `output/logs/` 目录下。

### 日志级别

- `DEBUG`: 详细的调试信息，仅在调试模式下输出
- `INFO`: 一般信息，如程序运行状态
- `WARNING`: 警告信息
- `ERROR`: 错误信息
- `CRITICAL`: 严重错误信息

### 日志文件

- `backtest.log`: 回测引擎日志
- `data.log`: 数据处理日志
- `main.log`: 主程序日志

## 调试信息输出

在调试模式下，项目会在以下关键位置输出调试信息：

### 数据获取 (`get_data.py`)

- API 调用参数
- 数据获取进度
- 数据保存路径

### 数据清洗 (`data_cleaner.py`)

- 数据质量检查结果
- 缺失值和重复值处理
- 数据转换过程

### 策略执行 (`strategies/`)

- 技术指标计算结果
- 交易信号生成条件
- 订单执行情况

### 回测引擎 (`engine/backtest_engine.py`)

- 回测参数配置
- 每日市场数据
- 账户资金变化
- 交易执行细节

## 数据验证和错误检查

项目包含以下数据验证和错误检查：

### 数据完整性检查

- 检查必填列是否存在
- 验证数据类型是否正确
- 检查日期格式是否有效

### 价格数据检查

- 检查价格是否为负数
- 验证价格数据的合理性
- 检查成交量是否为负数

### 交易逻辑检查

- 验证订单数量是否有效
- 检查账户资金是否充足
- 确保不会产生无效交易

## 调试方法

### 启用调试模式

1. 打开 `config.py` 文件
2. 将 `DEBUG_MODE` 设置为 `True`
3. 可选：将 `DEBUG_VERBOSE` 设置为 `True` 以获取更详细的信息

### 运行程序

```bash
python main.py
```

### 查看日志

运行程序后，可以在 `output/logs/` 目录下查看日志文件，了解程序的运行情况和可能的问题。

### 分析问题

根据日志信息，可以定位问题所在：

1. 检查错误信息和异常堆栈
2. 查看相关的调试输出
3. 分析数据流程和逻辑

## 常见问题排查

### 数据获取失败

- 检查网络连接
- 验证 API 配置
- 查看 `output/logs/data.log` 中的错误信息

### 策略不产生交易

- 检查策略参数配置
- 验证技术指标计算
- 查看 `output/logs/backtest.log` 中的策略执行日志

### 回测结果异常

- 检查初始资金和交易费用配置
- 验证数据质量
- 查看 `output/logs/backtest.log` 中的回测过程日志

## 示例

以下是一个调试模式下的日志示例：

```
DEBUG:backtest:开始回测，初始资金: 100000.0
DEBUG:backtest:处理日期: 2023-01-03
DEBUG:backtest:当前价格: 10.50
DEBUG:backtest:指标值: SMA(10)=10.35, SMA(30)=10.20
DEBUG:backtest:生成买入信号
DEBUG:backtest:执行买入订单，数量: 9523, 价格: 10.50
DEBUG:backtest:账户资金变化: 100000.00 -> 0.00, 持股数量: 0 -> 9523
```

通过这些调试信息，可以清楚地了解策略的执行过程和交易决策依据。